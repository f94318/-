<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å®‰ä»˜ Â· å†·éœç·©è¡æ©Ÿåˆ¶</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c10;
    --surface: #111318;
    --surface2: #181c24;
    --border: #22273a;
    --accent: #00e5a0;
    --accent2: #ff6b35;
    --warn: #f0b429;
    --text: #e8eaf0;
    --muted: #5a6080;
    --staged: #4466ff;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans TC', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed; inset: 0;
    background:
      radial-gradient(ellipse 60% 50% at 20% 10%, rgba(0,229,160,0.06) 0%, transparent 60%),
      radial-gradient(ellipse 50% 40% at 80% 90%, rgba(68,102,255,0.08) 0%, transparent 60%);
    pointer-events: none;
  }

  /* â”€â”€ æ‰‹æ©Ÿå¤–æ®¼ â”€â”€ */
  .phone-shell {
    width: 390px; max-width: 100%;
    background: var(--surface);
    border-radius: 44px;
    border: 1px solid var(--border);
    overflow: hidden;
    box-shadow: 0 40px 100px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.04);
    position: relative;
  }

  /* â”€â”€ ç‹€æ…‹æ¬„ â”€â”€ */
  .status-bar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 14px 28px 0;
    font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted);
  }

  /* â”€â”€ ç•«é¢ â”€â”€ */
  .screen { display: none; padding: 0 0 36px; }
  .screen.active { display: block; animation: fadeIn 0.3s ease; }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* â”€â”€ é€²åº¦æ­¥é©Ÿæ¢ â”€â”€ */
  .step-bar {
    display: flex; align-items: center; justify-content: center;
    gap: 0; padding: 18px 28px 0;
  }
  .step-item {
    display: flex; flex-direction: column; align-items: center; gap: 4px;
    flex: 1;
  }
  .step-circle {
    width: 28px; height: 28px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 900;
    background: var(--surface2); border: 1.5px solid var(--border); color: var(--muted);
    transition: all 0.3s;
  }
  .step-circle.done  { background: rgba(0,229,160,0.15); border-color: var(--accent); color: var(--accent); }
  .step-circle.active{ background: var(--accent); border-color: var(--accent); color: #000; }
  .step-label { font-size: 9px; color: var(--muted); letter-spacing: 0.5px; transition: color 0.3s; }
  .step-label.active { color: var(--accent); }
  .step-label.done   { color: var(--muted); }
  .step-line {
    flex: 1; height: 1.5px; background: var(--border);
    margin: 0 4px; margin-bottom: 18px; /* align to circle center */
    transition: background 0.3s;
    max-width: 40px;
  }
  .step-line.done { background: var(--accent); }

  /* â”€â”€ é é¦–ï¼ˆå«è¿”å›ï¼‰ â”€â”€ */
  .screen-header {
    padding: 16px 28px 0;
    display: flex; align-items: center; gap: 12px;
  }
  .back-btn {
    width: 36px; height: 36px;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.2s; font-size: 16px; flex-shrink: 0;
  }
  .back-btn:hover { background: var(--border); }
  .screen-title { font-size: 17px; font-weight: 900; letter-spacing: 0.5px; }

  /* â”€â”€ è¡¨å–®æ¬„ä½ â”€â”€ */
  .form-section { padding: 24px 28px 0; }
  .form-title { font-size: 22px; font-weight: 900; letter-spacing: -0.3px; line-height: 1.3; }
  .form-sub   { font-size: 13px; color: var(--muted); margin-top: 6px; line-height: 1.6; }

  .field-block { margin-top: 24px; }
  .field-label-row {
    display: flex; justify-content: space-between; align-items: baseline;
    margin-bottom: 8px;
  }
  .field-label { font-size: 11px; color: var(--accent); font-weight: 700; letter-spacing: 0.8px; }
  .field-meta  { font-size: 10px; color: var(--muted); }

  /* å½ä½”ä½ç¬¦è¼¸å…¥æ¡†ï¼ˆç°è‰²0åº•ï¼‰ */
  .digit-input-wrap {
    position: relative;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 14px 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
    cursor: text;
  }
  .digit-input-wrap:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,229,160,0.1);
  }
  /* Character-grid digit display */
  .digit-display {
    font-family: 'Space Mono', monospace;
    font-size: 18px; letter-spacing: 3px;
    display: block; white-space: nowrap; overflow: hidden;
    line-height: 1.4; pointer-events: none; user-select: none;
    min-height: 1.4em;
  }
  .digit-display .dc { color: var(--text); }        /* typed digit */
  .digit-display .dp { color: var(--border); }      /* placeholder 0 */
  /* Hidden real input â€” captures typing but is invisible */
  .digit-real-hidden {
    position: absolute; inset: 0; padding: 14px 16px;
    font-family: 'Space Mono', monospace;
    font-size: 18px; letter-spacing: 3px;
    color: transparent; background: transparent;
    border: none; outline: none; width: 100%;
    caret-color: var(--accent);
    -webkit-text-fill-color: transparent;
  }
  .field-hint  { font-size: 10px; color: var(--muted); margin-top: 6px; }
  .field-error { font-size: 11px; color: var(--accent2); margin-top: 6px; min-height: 14px; }

  /* â”€â”€ é‡‘é¡è¼¸å…¥ â”€â”€ */
  .amount-hero { padding: 28px 28px 0; text-align: center; }
  .amount-label-sm { font-size: 11px; color: var(--muted); letter-spacing: 1px; margin-bottom: 10px; }
  .amount-row {
    display: flex; align-items: center; justify-content: center; gap: 4px;
  }
  .currency-sign { font-size: 32px; font-weight: 900; color: var(--accent); line-height:1; padding-bottom:4px; }
  .amount-input {
    background: transparent; border: none; outline: none;
    font-family: 'Noto Sans TC', sans-serif;
    font-size: 52px; font-weight: 900; color: var(--text);
    letter-spacing: -3px; width: 220px; text-align: left;
    caret-color: var(--accent);
  }
  .amount-input::placeholder { color: var(--border); }
  .amount-underline {
    height: 2px;
    background: linear-gradient(90deg, var(--accent), var(--staged));
    border-radius: 2px; margin: 4px auto 0; width: 260px;
    opacity: 0.5; transition: opacity 0.2s;
  }
  .amount-hint  { font-size: 11px; color: var(--muted); margin-top: 8px; }
  .amount-error { font-size: 11px; color: var(--accent2); margin-top: 6px; min-height: 16px; }
  .cooling-preview { font-size: 12px; font-weight: 700; margin-top: 4px; min-height: 18px; transition: color 0.3s; }

  /* â”€â”€ æ”¶æ¬¾äººæ‘˜è¦å¡ç‰‡ï¼ˆé‡‘é¡é ï¼‰ â”€â”€ */
  .recipient-summary {
    margin: 18px 28px 0;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 18px; padding: 14px 16px;
    display: flex; align-items: center; gap: 12px;
  }
  .rs-avatar {
    width: 40px; height: 40px;
    background: linear-gradient(135deg, #4466ff, #00e5a0);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; flex-shrink: 0;
  }
  .rs-info { flex: 1; }
  .rs-info .rs-name { font-size: 13px; font-weight: 700; }
  .rs-info .rs-acct { font-size: 11px; color: var(--muted); font-family: 'Space Mono', monospace; margin-top: 2px; }

  /* â”€â”€ BSP è­¦ç¤º â”€â”€ */
  .bsp-alert {
    margin: 14px 28px 0;
    background: rgba(240,180,41,0.1); border: 1px solid rgba(240,180,41,0.25);
    border-radius: 14px; padding: 12px 14px;
    display: flex; align-items: flex-start; gap: 10px;
    animation: pulse 2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { border-color: rgba(240,180,41,0.25); }
    50%      { border-color: rgba(240,180,41,0.5); }
  }
  .bsp-alert .icon { font-size: 16px; flex-shrink:0; margin-top:1px; }
  .bsp-alert p { font-size: 12px; color: var(--warn); line-height: 1.6; }
  .bsp-alert strong { font-weight: 700; }

  /* â”€â”€ æŒ‰éˆ• â”€â”€ */
  .primary-btn {
    display: block; margin: 20px 28px 0;
    background: var(--accent); color: #000; border: none;
    border-radius: 18px; padding: 18px;
    font-family: 'Noto Sans TC', sans-serif; font-size: 15px; font-weight: 900;
    cursor: pointer; width: calc(100% - 56px);
    transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
    box-shadow: 0 8px 30px rgba(0,229,160,0.3);
  }
  .primary-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(0,229,160,0.4); }
  .primary-btn:active  { transform: translateY(0); }
  .primary-btn:disabled{ opacity: 0.35; cursor: not-allowed; }

  .secondary-btn {
    display: block; margin: 12px 28px 0;
    background: transparent; color: var(--muted);
    border: 1px solid var(--border); border-radius: 18px; padding: 16px;
    font-family: 'Noto Sans TC', sans-serif; font-size: 14px; font-weight: 500;
    cursor: pointer; width: calc(100% - 56px);
    transition: background 0.2s, color 0.2s; text-align: center;
  }
  .secondary-btn:hover { background: var(--surface2); color: var(--text); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     å†·éœç·©è¡ï¼šå…§åµŒæ–¼è½‰å¸³é 
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  /* ç·©è¡è¦†è“‹å±¤ï¼ˆæ»‘å…¥æ›¿æ›è½‰å¸³é å…§å®¹ï¼‰ */
  .buffer-overlay {
    display: none;
    padding: 0 0 32px;
    animation: fadeIn 0.4s ease;
  }
  .buffer-overlay.active { display: block; }

  .staged-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(68,102,255,0.15); border: 1px solid rgba(68,102,255,0.3);
    border-radius: 8px; padding: 5px 12px;
    font-size: 11px; font-weight: 700; color: var(--staged);
    margin: 16px 28px 0;
  }
  .staged-dot {
    width:6px; height:6px; background:var(--staged); border-radius:50%;
    animation: blink 1.2s ease infinite; flex-shrink:0;
  }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

  .cooling-reason-badge {
    display: flex; align-items: center; gap: 6px;
    background: rgba(240,180,41,0.08); border: 1px solid rgba(240,180,41,0.2);
    border-radius: 8px; padding: 5px 12px;
    font-size: 11px; font-weight: 700; color: var(--warn);
    margin: 8px 28px 0;
  }

  .buffer-hero { padding: 22px 28px 0; text-align: center; }
  .shield-ring { width: 140px; height: 140px; margin: 0 auto; position: relative; }
  .ring-svg { width: 100%; height: 100%; transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: var(--surface2); stroke-width: 8; }
  .ring-progress {
    fill: none; stroke: var(--accent); stroke-width: 8;
    stroke-linecap: round; stroke-dasharray: 345; stroke-dashoffset: 0;
    transition: stroke-dashoffset 1s linear, stroke 0.5s;
  }
  .shield-inner {
    position: absolute; inset: 0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .shield-icon { font-size: 26px; }
  .timer-text {
    font-family: 'Space Mono', monospace;
    font-size: 22px; font-weight: 700; color: var(--accent);
    letter-spacing: -1px; line-height: 1; margin-top: 2px;
  }
  .timer-label { font-size: 9px; color: var(--muted); letter-spacing: 1px; margin-top: 2px; }
  .buffer-title { font-size: 20px; font-weight: 900; margin-top: 18px; line-height: 1.3; }
  .buffer-subtitle { font-size: 13px; color: var(--muted); margin-top: 8px; line-height: 1.7; }
  .staged-amount-row {
    display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 10px;
  }
  .staged-amount-value { font-size: 28px; font-weight: 900; color: var(--accent); letter-spacing: -1px; }

  /* â”€â”€ ç‹€æ…‹æ ¼ â”€â”€ */
  .status-grid {
    display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 16px 28px 0;
  }
  .status-pill {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 16px; padding: 14px; text-align: center;
  }
  .status-pill .pill-icon  { font-size: 20px; }
  .status-pill .pill-label { font-size: 10px; color: var(--muted); margin-top: 4px; }
  .status-pill .pill-value { font-size: 12px; font-weight: 700; margin-top: 2px; color: var(--accent); }
  .status-pill.warn .pill-value { color: var(--warn); }

  /* â”€â”€ BSP æŒ‡æ¨™ â”€â”€ */
  .bsp-indicator {
    margin: 12px 28px 0;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 16px; padding: 14px 16px;
  }
  .bsp-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
  .bsp-label-txt { font-size: 11px; color: var(--muted); }
  .bsp-level-txt { font-size: 11px; font-weight: 700; color: var(--accent); transition: color 0.5s; }
  .bsp-bar-bg { background: var(--border); border-radius: 4px; height: 6px; }
  .bsp-bar-fill {
    background: linear-gradient(90deg, var(--accent), var(--staged));
    border-radius: 4px; height: 6px; width: 22%;
    transition: width 2s ease, background 1.5s ease;
  }
  .bsp-triggers { margin-top: 10px; display: flex; gap: 6px; flex-wrap: wrap; }
  .bsp-tag {
    background: rgba(0,229,160,0.08); border: 1px solid rgba(0,229,160,0.2);
    color: var(--accent); border-radius: 6px; padding: 3px 8px;
    font-size: 10px; font-weight: 700;
    transition: background 0.4s, border-color 0.4s, color 0.4s;
  }
  .bsp-tag.elevated { background: rgba(240,180,41,0.12); border-color: rgba(240,180,41,0.3); color: var(--warn); }

  .withdraw-btn {
    display: block; margin: 14px 28px 0;
    background: rgba(0,229,160,0.1); color: var(--accent);
    border: 1px solid rgba(0,229,160,0.3); border-radius: 18px; padding: 18px;
    font-family: 'Noto Sans TC', sans-serif; font-size: 15px; font-weight: 700;
    cursor: pointer; width: calc(100% - 56px); transition: all 0.2s; text-align: center;
  }
  .withdraw-btn:hover { background: rgba(0,229,160,0.2); border-color: rgba(0,229,160,0.5); }

  /* â”€â”€ è±å…è·¯å¾‘ â”€â”€ */
  .exemption-section { padding: 20px 28px 0; }
  .section-label { font-size: 10px; color: var(--muted); letter-spacing: 1.5px; margin-bottom: 12px; }
  .exemption-option {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 18px; padding: 16px;
    display: flex; align-items: center; gap: 14px;
    margin-bottom: 10px; cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
  }
  .exemption-option:hover { border-color: var(--accent); background: rgba(0,229,160,0.04); }
  .option-icon-wrap {
    width: 46px; height: 46px; border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px; flex-shrink: 0;
  }
  .opt-green  { background: rgba(0,229,160,0.15); }
  .opt-blue   { background: rgba(68,102,255,0.15); }
  .opt-orange { background: rgba(255,107,53,0.15); }
  .option-text h4 { font-size: 14px; font-weight: 700; }
  .option-text p  { font-size: 11px; color: var(--muted); margin-top: 2px; line-height: 1.5; }
  .option-arrow   { margin-left: auto; color: var(--muted); font-size: 18px; flex-shrink: 0; }

  /* â”€â”€ ç™½åå–®å±•é–‹é¢æ¿ â”€â”€ */
  .whitelist-panel {
    display: none;
    background: rgba(0,229,160,0.04); border: 1px solid rgba(0,229,160,0.2);
    border-radius: 16px; padding: 18px; margin: -4px 0 10px;
    animation: fadeIn 0.25s ease;
  }
  .whitelist-panel.open { display: block; }
  .wl-field-group { margin-bottom: 14px; }
  .wl-field-label {
    font-size: 10px; color: var(--accent); font-weight: 700;
    letter-spacing: 0.8px; margin-bottom: 6px; display: block;
  }
  .wl-field-input {
    width: 100%;
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 12px; padding: 12px 14px;
    font-family: 'Space Mono', monospace;
    font-size: 14px; color: var(--text); outline: none;
    transition: border-color 0.2s, box-shadow 0.2s; letter-spacing: 2px;
  }
  .wl-field-input::placeholder { color: var(--muted); letter-spacing: 0; font-size: 12px; font-family: 'Noto Sans TC', sans-serif; }
  .wl-field-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,229,160,0.1); }
  .wl-field-hint  { font-size: 10px; color: var(--muted); margin-top: 5px; }
  .panel-submit-btn {
    width: 100%; background: var(--accent); color: #000;
    border: none; border-radius: 12px; padding: 13px;
    font-family: 'Noto Sans TC', sans-serif; font-size: 14px; font-weight: 900;
    cursor: pointer; transition: opacity 0.2s, transform 0.15s;
  }
  .panel-submit-btn:hover { opacity: 0.88; transform: translateY(-1px); }
  .panel-error { font-size: 11px; color: var(--accent2); margin-bottom: 10px; min-height: 14px; }

  /* â”€â”€ æ©Ÿæ§‹é¡åˆ¥é¸å–® â”€â”€ */
  .category-grid {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 12px; padding: 20px 28px 0;
  }
  .category-card {
    background: var(--surface2); border: 2px solid var(--border);
    border-radius: 20px; padding: 20px 14px;
    display: flex; flex-direction: column; align-items: center; gap: 10px;
    cursor: pointer; transition: border-color 0.2s, background 0.2s, transform 0.15s;
    text-align: center;
  }
  .category-card:hover  { border-color: var(--staged); background: rgba(68,102,255,0.06); transform: translateY(-2px); }
  .category-card.selected { border-color: var(--staged); background: rgba(68,102,255,0.1); }
  .category-card .cat-icon { font-size: 32px; }
  .category-card .cat-name { font-size: 13px; font-weight: 700; color: var(--text); }
  .category-card .cat-desc { font-size: 10px; color: var(--muted); line-height: 1.4; margin-top: 2px; }

  /* â”€â”€ æ©Ÿæ§‹å¸³è™Ÿè¼¸å…¥ â”€â”€ */
  .utility-acct-section { padding: 22px 28px 0; }
  .selected-category-badge {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(68,102,255,0.12); border: 1px solid rgba(68,102,255,0.3);
    border-radius: 12px; padding: 8px 14px; margin-bottom: 20px;
    font-size: 13px; font-weight: 700; color: var(--staged);
  }
  .utility-confirm-card {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 18px; padding: 16px;
    display: flex; align-items: center; gap: 12px;
    margin-bottom: 16px;
  }
  .uc-icon { font-size: 28px; }
  .uc-info .uc-name { font-size: 14px; font-weight: 700; }
  .uc-info .uc-acct { font-size: 11px; color: var(--muted); font-family: 'Space Mono', monospace; margin-top: 2px; }
  .qr-section { padding: 24px 28px 0; text-align: center; }
  .qr-frame {
    width: 200px; height: 200px; margin: 0 auto 20px;
    border: 2px solid var(--accent); border-radius: 24px;
    position: relative; display: flex; align-items: center; justify-content: center;
    background: var(--surface2); overflow: hidden;
  }
  .qr-corner { position: absolute; width: 24px; height: 24px; border-color: var(--accent); border-style: solid; border-width: 0; }
  .qr-corner.tl { top:10px;    left:10px;  border-top-width:3px;    border-left-width:3px;  border-top-left-radius:6px; }
  .qr-corner.tr { top:10px;    right:10px; border-top-width:3px;    border-right-width:3px; border-top-right-radius:6px; }
  .qr-corner.bl { bottom:10px; left:10px;  border-bottom-width:3px; border-left-width:3px;  border-bottom-left-radius:6px; }
  .qr-corner.br { bottom:10px; right:10px; border-bottom-width:3px; border-right-width:3px; border-bottom-right-radius:6px; }
  .scan-line {
    position: absolute; left:14px; right:14px; height:2px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    top:14px; animation: scan 2.5s ease-in-out infinite;
    box-shadow: 0 0 12px var(--accent);
  }
  @keyframes scan { 0%{top:14px} 50%{top:calc(100% - 16px)} 100%{top:14px} }
  .qr-icon { font-size: 44px; opacity: 0.2; }
  .qr-info { font-size: 13px; color: var(--muted); line-height: 1.6; margin-top: 4px; }

  /* â”€â”€ å–æ¬¾ç¢ºèª â”€â”€ */
  .withdraw-screen { padding: 28px 28px 0; text-align: center; }
  .big-icon { font-size: 64px; margin-bottom: 16px; }
  .confirm-title { font-size: 22px; font-weight: 900; letter-spacing: 0.3px; }
  .confirm-sub { font-size: 13px; color: var(--muted); margin-top: 8px; line-height: 1.6; max-width: 280px; margin-left:auto; margin-right:auto; }
  .amount-confirm {
    margin: 20px 0; background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 20px;
  }
  .amount-confirm .label { font-size: 11px; color: var(--muted); letter-spacing: 0.5px; }
  .amount-confirm .value { font-size: 36px; font-weight: 900; letter-spacing: -2px; color: var(--accent); margin-top: 4px; }
  .danger-btn {
    display: block; margin: 0 0 12px;
    background: rgba(255,107,53,0.15); color: var(--accent2);
    border: 1px solid rgba(255,107,53,0.3); border-radius: 18px; padding: 18px;
    font-family: 'Noto Sans TC', sans-serif; font-size: 15px; font-weight: 700;
    cursor: pointer; width: 100%; transition: all 0.2s; text-align: center;
  }
  .danger-btn:hover { background: rgba(255,107,53,0.25); }

  /* â”€â”€ æˆåŠŸå‹•ç•« â”€â”€ */
  .success-anim { animation: successPop 0.5s cubic-bezier(0.34,1.56,0.64,1); }
  @keyframes successPop { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }

  /* â”€â”€ é›œé … â”€â”€ */
  .divider { height:1px; background:var(--border); margin:16px 28px 0; }
  .row-between { display:flex; justify-content:space-between; align-items:center; }

  /* â”€â”€ å°è¦½æ¨™ç±¤ï¼ˆç„¡ã€Œç·©è¡ä¸­ã€ï¼‰ â”€â”€ */
  .nav-tabs { display:flex; padding:14px 28px 0; gap:8px; flex-wrap:wrap; }
  .nav-tab {
    background: var(--surface2); border: 1px solid var(--border);
    border-radius: 10px; padding: 6px 12px;
    font-size: 11px; font-weight: 700; color: var(--muted);
    cursor: pointer; transition: all 0.2s; font-family: 'Noto Sans TC', sans-serif;
  }
  .nav-tab.active { background: var(--accent); color: #000; border-color: var(--accent); }
  .nav-tab:hover:not(.active) { border-color: var(--accent); color: var(--accent); }
</style>
</head>
<body>

<div class="phone-shell">

  <!-- ç‹€æ…‹æ¬„ -->
  <div class="status-bar">
    <span>9:41</span>
    <span>å®‰ä»˜ SafePay</span>
    <span>â—â—â— 100%</span>
  </div>

  <!-- å°è¦½æ¨™ç±¤ï¼ˆåƒ…ä¸‰é ï¼Œç„¡ã€Œç·©è¡ä¸­ã€ï¼‰ -->
  <div class="nav-tabs">
    <div class="nav-tab active" onclick="navTo('bank')">è½‰å¸³</div>
    <div class="nav-tab" onclick="navTo('exemption')">è±å…è·¯å¾‘</div>
    <div class="nav-tab" onclick="navTo('qr')">æƒæ QR</div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ S1ï¼šè¼¸å…¥éŠ€è¡Œä»£ç¢¼èˆ‡å¸³è™Ÿ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen active" id="screen-bank">

    <!-- æ­¥é©Ÿæ¢ï¼š1 of 2 -->
    <div class="step-bar">
      <div class="step-item">
        <div class="step-circle active">1</div>
        <div class="step-label active">æ”¶æ¬¾å¸³è™Ÿ</div>
      </div>
      <div class="step-line"></div>
      <div class="step-item">
        <div class="step-circle" id="step2circle">2</div>
        <div class="step-label" id="step2label">è½‰å¸³é‡‘é¡</div>
      </div>
    </div>

    <div class="form-section">
      <div class="form-title">æ”¶æ¬¾æ–¹è³‡è¨Š</div>
      <div class="form-sub">è«‹è¼¸å…¥æ”¶æ¬¾æ–¹çš„éŠ€è¡Œä»£ç¢¼èˆ‡å¸³è™Ÿï¼Œç³»çµ±å°‡è‡ªå‹•é©—è­‰ã€‚</div>

      <!-- éŠ€è¡Œä»£ç¢¼ï¼ˆé è¨­ 3 ä½ï¼Œä½”ä½ç¬¦ 000ï¼‰ -->
      <div class="field-block">
        <div class="field-label-row">
          <span class="field-label">éŠ€è¡Œä»£ç¢¼</span>
          <span class="field-meta">3 ä½æ•¸å­—</span>
        </div>
        <div class="digit-input-wrap" onclick="document.getElementById('bankCodeInput').focus()">
          <span class="digit-display" id="bankCodeDisplay"><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span></span>
          <input
            id="bankCodeInput"
            class="digit-real-hidden"
            type="text"
            inputmode="numeric"
            maxlength="7"
            autocomplete="off"
            oninput="onBankCodeInput(this)"
          />
        </div>
        <div class="field-hint">ä¾‹ï¼š004 = å°ç£éŠ€è¡Œï¼Œ013 = åœ‹æ³°ä¸–è¯ï¼Œ822 = ä¸­ä¿¡éŠ€è¡Œ</div>
        <div class="field-error" id="bankCodeError"></div>
      </div>

      <!-- éŠ€è¡Œå¸³è™Ÿï¼ˆé è¨­ 16 ä½ï¼Œä½”ä½ç¬¦ 0000000000000000ï¼‰ -->
      <div class="field-block">
        <div class="field-label-row">
          <span class="field-label">éŠ€è¡Œå¸³è™Ÿ</span>
          <span class="field-meta">æœ€å¤š 16 ä½æ•¸å­—</span>
        </div>
        <div class="digit-input-wrap" onclick="document.getElementById('bankAcctInput').focus()">
          <span class="digit-display" id="bankAcctDisplay"><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span></span>
          <input
            id="bankAcctInput"
            class="digit-real-hidden"
            type="text"
            inputmode="numeric"
            maxlength="16"
            autocomplete="off"
            oninput="onBankAcctInput(this)"
          />
        </div>
        <div class="field-hint">è«‹è¼¸å…¥ 10ï½16 ä½æ•¸å­—å¸³è™Ÿï¼ˆä¸å«ç©ºæ ¼æˆ–é€£å­—è™Ÿï¼‰</div>
        <div class="field-error" id="bankAcctError"></div>
      </div>
    </div>

    <button class="primary-btn" id="nextToAmountBtn" onclick="goToAmount()" disabled>
      ä¸‹ä¸€æ­¥ï¼šè¼¸å…¥é‡‘é¡ â†’
    </button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ S2ï¼šè¼¸å…¥é‡‘é¡ï¼ˆå«ç·©è¡è¦†è“‹å±¤ï¼‰
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-amount">

    <!-- â”€â”€ è½‰å¸³è¼¸å…¥å€ï¼ˆç·©è¡å‰é¡¯ç¤ºï¼‰ â”€â”€ -->
    <div id="transferContent">

      <!-- æ­¥é©Ÿæ¢ï¼š2 of 2 -->
      <div class="step-bar">
        <div class="step-item">
          <div class="step-circle done">âœ“</div>
          <div class="step-label done">æ”¶æ¬¾å¸³è™Ÿ</div>
        </div>
        <div class="step-line done"></div>
        <div class="step-item">
          <div class="step-circle active">2</div>
          <div class="step-label active">è½‰å¸³é‡‘é¡</div>
        </div>
      </div>

      <div class="screen-header" style="padding-top:14px;">
        <div class="back-btn" onclick="showScreen('bank')">â†</div>
        <div class="screen-title">è¼¸å…¥è½‰å¸³é‡‘é¡</div>
      </div>

      <!-- æ”¶æ¬¾äººæ‘˜è¦ -->
      <div class="recipient-summary">
        <div class="rs-avatar">ğŸ‘¤</div>
        <div class="rs-info">
          <div class="rs-name">æ”¶æ¬¾æ–¹</div>
          <div class="rs-acct" id="recipientAcctDisplay">â€”</div>
        </div>
      </div>

      <!-- é‡‘é¡è¼¸å…¥ -->
      <div class="amount-hero">
        <div class="amount-label-sm">è½‰å¸³é‡‘é¡ï¼ˆæ–°å°å¹£ï¼‰</div>
        <div class="amount-row">
          <div class="currency-sign">$</div>
          <input
            id="amountInput"
            class="amount-input"
            type="text"
            inputmode="decimal"
            placeholder="0"
            maxlength="13"
            oninput="onAmountInput(this)"
            onblur="onAmountBlur(this)"
          />
        </div>
        <div class="amount-underline"></div>
        <div class="amount-hint">ä¾‹ï¼šè¼¸å…¥ 2500 å³ç‚ºæ–°å°å¹£ $2,500</div>
        <div class="amount-error" id="amountError"></div>
        <div class="cooling-preview" id="coolingPreview"></div>
      </div>

      <div class="bsp-alert">
        <div class="icon">ğŸ“</div>
        <p><strong>åµæ¸¬åˆ°é€šè©±ä¸­ã€‚</strong>ç³»çµ±æ­£ä¾æ“šæ‚¨çš„æ“ä½œè¡Œç‚ºèˆ‡é‡‘é¡è‡ªå‹•è¨ˆç®—ç·©è¡æ™‚é–“ï¼Œæ”¶æ¬¾æ–¹åœ¨è½‰å¸³å®Œæˆå‰ä¸æœƒæ”¶åˆ°é€šçŸ¥ã€‚</p>
      </div>

      <button class="primary-btn" id="confirmTransferBtn" onclick="goToBuffer()" disabled>
        ç¢ºèªè½‰å¸³
      </button>
      <button class="secondary-btn" onclick="goToExemptionFromTransfer()">
        é€éè±å…è·¯å¾‘ç›´æ¥è½‰å¸³
      </button>
    </div>

    <!-- â”€â”€ å†·éœç·©è¡è¦†è“‹å±¤ï¼ˆç¢ºèªå¾Œé¡¯ç¤ºï¼‰ â”€â”€ -->
    <div class="buffer-overlay" id="bufferOverlay">

      <div class="staged-badge">
        <div class="staged-dot"></div>
        æš«å­˜ä¸­ â€” è³‡é‡‘ä¿ç•™ï¼Œå°šæœªç™¼é€
      </div>

      <div class="cooling-reason-badge">
        <span>â±</span>
        <span id="coolingReason">è¨ˆç®—ä¸­â€¦</span>
      </div>

      <div class="buffer-hero">
        <div class="shield-ring">
          <svg class="ring-svg" viewBox="0 0 120 120">
            <circle class="ring-bg"       cx="60" cy="60" r="54"/>
            <circle class="ring-progress" id="ringProgress" cx="60" cy="60" r="54"/>
          </svg>
          <div class="shield-inner">
            <div class="shield-icon">ğŸ›¡</div>
            <div class="timer-text"  id="timerDisplay">--:--</div>
            <div class="timer-label">å‰©é¤˜æ™‚é–“</div>
          </div>
        </div>

        <div class="buffer-title">æ‚¨çš„è³‡é‡‘å®‰å…¨æš«å­˜ä¸­</div>
        <div class="buffer-subtitle">
          æ”¶æ¬¾æ–¹<strong style="color:var(--text)">å°šæœªæ”¶åˆ°ä»»ä½•é€šçŸ¥</strong>ã€‚
        </div>
        <div class="staged-amount-row">
          <div style="font-size:13px;color:var(--muted);">æš«å­˜é‡‘é¡</div>
          <div class="staged-amount-value" id="bufferAmountDisplay">â€”</div>
        </div>
      </div>

      <div class="status-grid">
        <div class="status-pill">
          <div class="pill-icon">ğŸ”•</div>
          <div class="pill-label">æ”¶æ¬¾æ–¹é€šçŸ¥</div>
          <div class="pill-value">æœªé€šçŸ¥</div>
        </div>
        <div class="status-pill">
          <div class="pill-icon">ğŸ’°</div>
          <div class="pill-label">è³‡é‡‘ç‹€æ…‹</div>
          <div class="pill-value">æš«å­˜ä¸­</div>
        </div>
        <div class="status-pill warn">
          <div class="pill-icon">â±</div>
          <div class="pill-label">ç·©è¡æ™‚é•·</div>
          <div class="pill-value" id="bufferDurationPill">â€”</div>
        </div>
        <div class="status-pill warn">
          <div class="pill-icon">ğŸ”„</div>
          <div class="pill-label">BSP æ¨¡å‹</div>
          <div class="pill-value" id="bspStatusPill">æ­£å¸¸</div>
        </div>
      </div>

      <div class="bsp-indicator">
        <div class="bsp-top">
          <span class="bsp-label-txt">BSP è¡Œç‚ºå£“åŠ›åˆ†æ•¸</span>
          <span class="bsp-level-txt" id="bspLevelText">æ­£å¸¸ Â· 22%</span>
        </div>
        <div class="bsp-bar-bg"><div class="bsp-bar-fill" id="bspBar"></div></div>
        <div class="bsp-triggers">
          <span class="bsp-tag" id="bspTag1">ğŸ“ é€šè©±ä¸­</span>
          <span class="bsp-tag" id="bspTag2">â¸ è¼•å¾®çŒ¶è±«</span>
        </div>
      </div>

      <button class="withdraw-btn" onclick="showWithdraw()">
        â† å–æ¶ˆä¸¦ç«‹å³å–å›è³‡é‡‘
      </button>
    </div>

  </div><!-- /screen-amount -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šè±å…è·¯å¾‘
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-exemption">
    <div class="screen-header">
      <div class="back-btn" id="exemptionBackBtn" onclick="showScreen('bank')">â†</div>
      <div class="screen-title">è±å…è·¯å¾‘</div>
    </div>

    <div class="exemption-section">
      <div class="section-label">é€éå¯ä¿¡ç®¡é“è·³éç·©è¡æœŸ</div>

      <div class="exemption-option" id="wlOption" onclick="toggleWhitelistPanel()">
        <div class="option-icon-wrap opt-green">ğŸ‘¥</div>
        <div class="option-text">
          <h4>ä¿¡ä»»è¯çµ¡äººï¼ˆç™½åå–®ï¼‰</h4>
          <p>è¼¸å…¥æ”¶æ¬¾æ–¹éŠ€è¡Œä»£ç¢¼èˆ‡å¸³è™Ÿï¼Œå®Œæˆåœ°ç†ä½ç½®é©—è­‰å¾Œå³å¯ç›´æ¥è½‰å¸³ã€‚</p>
        </div>
        <div class="option-arrow" id="wlArrow">â€º</div>
      </div>

      <div class="whitelist-panel" id="whitelistPanel">
        <div class="wl-field-group">
          <label class="wl-field-label" for="wlBankCode">éŠ€è¡Œä»£ç¢¼</label>
          <input id="wlBankCode" class="wl-field-input" type="text" inputmode="numeric" placeholder="ä¾‹ï¼š004ï¼ˆå°ç£éŠ€è¡Œï¼‰" maxlength="7" oninput="this.value=this.value.replace(/\D/g,'')"/>
          <div class="wl-field-hint">è«‹è¼¸å…¥ 3ï½7 ä½æ•¸å­—éŠ€è¡Œä»£ç¢¼</div>
        </div>
        <div class="wl-field-group">
          <label class="wl-field-label" for="wlBankAcct">éŠ€è¡Œå¸³è™Ÿ</label>
          <input id="wlBankAcct" class="wl-field-input" type="text" inputmode="numeric" placeholder="ä¾‹ï¼š0123456789012" maxlength="16" oninput="this.value=this.value.replace(/\D/g,'')"/>
          <div class="wl-field-hint">è«‹è¼¸å…¥ 10ï½16 ä½æ•¸å­—å¸³è™Ÿ</div>
        </div>
        <div class="panel-error" id="wlError"></div>
        <button class="panel-submit-btn" onclick="submitWhitelist()">é©—è­‰ä¸¦ç«‹å³è½‰å¸³ â†’</button>
      </div>

      <div class="exemption-option" onclick="showScreen('utility-category')">
        <div class="option-icon-wrap opt-blue">ğŸ¢</div>
        <div class="option-text">
          <h4>å·²é©—è­‰æ©Ÿæ§‹</h4>
          <p>ç›´æ¥ç¹³è²»çµ¦å·²é©—è­‰çš„å…¬ç”¨äº‹æ¥­ã€æ”¿åºœæ©Ÿé—œæˆ–æŒç‰Œé‡‘èæ©Ÿæ§‹ã€‚</p>
        </div>
        <div class="option-arrow">â€º</div>
      </div>

      <div class="exemption-option" onclick="showScreen('qr')">
        <div class="option-icon-wrap opt-orange">ğŸ“±</div>
        <div class="option-text">
          <h4>ç¾å ´å‹•æ…‹ QR ç¢¼</h4>
          <p>æƒæå•†å®¶çš„å‹•æ…‹æ—‹è½‰ QR ç¢¼ï¼Œç¢ºèªå¯¦éš›åˆ°å ´å¾Œç«‹å³è·³éç·©è¡æœŸã€‚</p>
        </div>
        <div class="option-arrow">â€º</div>
      </div>
    </div>

    <div class="divider"></div>
    <div style="padding:16px 28px 0;">
      <div style="background:rgba(0,229,160,0.06);border:1px solid rgba(0,229,160,0.15);border-radius:14px;padding:14px 16px;">
        <div style="font-size:11px;color:var(--accent);font-weight:700;margin-bottom:6px;">ç‚ºä»€éº¼è¨­æœ‰è±å…è·¯å¾‘ï¼Ÿ</div>
        <div style="font-size:12px;color:var(--muted);line-height:1.7;">è©é¨™é›†åœ˜ç„¡æ³•å½é€ å¯¦éš›åˆ°å ´ã€å·²é©—è­‰çš„ QR ç¢¼ï¼Œæˆ–å·²å®Œæˆåœ°ç†ä½ç½®æ ¸æŸ¥çš„ä¿¡ä»»å¸³æˆ¶ã€‚é€™äº›è·¯å¾‘åƒ…åœ¨æ‚¨çš„èº«ä»½èˆ‡ä½ç½®çš†ç²ç¢ºèªå¾Œï¼Œæ–¹å¯ç¹éç·©è¡ä¿è­·ã€‚</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šå·²é©—è­‰æ©Ÿæ§‹ â€” é¸æ“‡é¡åˆ¥
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-utility-category">
    <div class="screen-header">
      <div class="back-btn" onclick="showScreen('exemption')">â†</div>
      <div class="screen-title">é¸æ“‡æ©Ÿæ§‹é¡åˆ¥</div>
    </div>

    <div style="padding:14px 28px 0;">
      <div style="font-size:13px;color:var(--muted);line-height:1.6;">è«‹é¸æ“‡æ”¶æ¬¾æ©Ÿæ§‹çš„é¡åˆ¥ï¼Œç³»çµ±å°‡è‡ªå‹•å¥—ç”¨å°æ‡‰çš„é©—è­‰è¦å‰‡ã€‚</div>
    </div>

    <div class="category-grid">
      <div class="category-card" onclick="selectUtilityCategory('school','ğŸ«','å­¸æ ¡','å„ç´šå…¬ç§ç«‹å­¸æ ¡ã€å¤§å­¸')">
        <div class="cat-icon">ğŸ«</div>
        <div class="cat-name">å­¸æ ¡</div>
        <div class="cat-desc">å„ç´šå…¬ç§ç«‹å­¸æ ¡<br>å¤§å­¸é™¢æ ¡</div>
      </div>
      <div class="category-card" onclick="selectUtilityCategory('hospital','ğŸ¥','é†«é™¢','å…¬ç§ç«‹é†«é™¢ã€è¨ºæ‰€')">
        <div class="cat-icon">ğŸ¥</div>
        <div class="cat-name">é†«é™¢</div>
        <div class="cat-desc">å…¬ç§ç«‹é†«é™¢<br>è¨ºæ‰€ã€é†«ç™‚æ©Ÿæ§‹</div>
      </div>
      <div class="category-card" onclick="selectUtilityCategory('gov','ğŸ›','æ”¿åºœæ©Ÿé—œ','ä¸­å¤®åŠåœ°æ–¹æ”¿åºœ')">
        <div class="cat-icon">ğŸ›</div>
        <div class="cat-name">æ”¿åºœæ©Ÿé—œ</div>
        <div class="cat-desc">ä¸­å¤®åŠåœ°æ–¹æ”¿åºœ<br>å…¬ç‡Ÿäº‹æ¥­å–®ä½</div>
      </div>
      <div class="category-card" onclick="selectUtilityCategory('other','ğŸ¢','å…¶ä»–æ©Ÿæ§‹','å…¶ä»–å·²é©—è­‰æ©Ÿæ§‹')">
        <div class="cat-icon">ğŸ¢</div>
        <div class="cat-name">å…¶ä»–</div>
        <div class="cat-desc">å…¶ä»–å·²é©—è­‰æ©Ÿæ§‹<br>æŒç‰Œé‡‘èæ©Ÿæ§‹</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šå·²é©—è­‰æ©Ÿæ§‹ â€” è¼¸å…¥å¸³è™Ÿä¸¦ç¢ºèª
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-utility-acct">
    <div class="screen-header">
      <div class="back-btn" onclick="showScreen('utility-category')">â†</div>
      <div class="screen-title">è¼¸å…¥æ©Ÿæ§‹å¸³è™Ÿ</div>
    </div>

    <div class="utility-acct-section">
      <div class="selected-category-badge">
        <span id="utilitySelIcon">ğŸ¢</span>
        <span id="utilitySelName">å·²é©—è­‰æ©Ÿæ§‹</span>
      </div>

      <div class="field-block" style="margin-top:0;">
        <div class="field-label-row">
          <span class="field-label">æ©Ÿæ§‹éŠ€è¡Œå¸³è™Ÿ</span>
          <span class="field-meta">10ï½16 ä½æ•¸å­—</span>
        </div>
        <div class="digit-input-wrap" onclick="document.getElementById('utilityAcctInput').focus()">
          <span class="digit-display" id="utilityAcctDisplay"><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span><span class="dp">0</span></span>
          <input
            id="utilityAcctInput"
            class="digit-real-hidden"
            type="text"
            inputmode="numeric"
            maxlength="16"
            autocomplete="off"
            oninput="onUtilityAcctInput(this)"
          />
        </div>
        <div class="field-hint">è«‹è¼¸å…¥æ©Ÿæ§‹çš„éŠ€è¡Œå¸³è™Ÿï¼ˆ10ï½16 ä½æ•¸å­—ï¼‰</div>
        <div class="field-error" id="utilityAcctError"></div>
      </div>

      <!-- ç¢ºèªæ‘˜è¦å¡ -->
      <div class="utility-confirm-card" id="utilityConfirmCard" style="display:none; margin-top:20px;">
        <div class="uc-icon" id="utilityConfirmIcon">ğŸ¢</div>
        <div class="uc-info">
          <div class="uc-name" id="utilityConfirmName">æ©Ÿæ§‹åç¨±</div>
          <div class="uc-acct" id="utilityConfirmAcct">å¸³è™Ÿï¼šâ€”</div>
        </div>
      </div>

      <div style="height:6px;"></div>

      <div style="background:rgba(68,102,255,0.06);border:1px solid rgba(68,102,255,0.2);border-radius:12px;padding:12px 14px;margin-top:16px;">
        <div style="font-size:10px;color:var(--staged);font-weight:700;margin-bottom:4px;">âœ“ å·²é©—è­‰æ©Ÿæ§‹è½‰å¸³èªªæ˜</div>
        <div style="font-size:11px;color:var(--muted);line-height:1.7;">ç³»çµ±å·²ç¢ºèªæ­¤å¸³è™Ÿå±¬æ–¼å·²é©—è­‰çš„å…¬å…±æ©Ÿæ§‹ï¼Œæœ¬æ¬¡è½‰å¸³å°‡è·³éå†·éœç·©è¡æœŸï¼Œç›´æ¥åŸ·è¡Œã€‚</div>
      </div>
    </div>

    <button class="primary-btn" id="utilityConfirmBtn" onclick="submitUtilityTransfer()" disabled>
      ç¢ºèªè½‰å¸³è‡³æ©Ÿæ§‹ â†’
    </button>
    <button class="secondary-btn" onclick="showScreen('utility-category')">è¿”å›é‡æ–°é¸æ“‡</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šQR æƒæ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-qr">
    <div class="screen-header">
      <div class="back-btn" onclick="showScreen('exemption')">â†</div>
      <div class="screen-title">æƒæå•†å®¶ QR ç¢¼</div>
    </div>
    <div class="qr-section">
      <div class="qr-frame">
        <div class="qr-corner tl"></div><div class="qr-corner tr"></div>
        <div class="qr-corner bl"></div><div class="qr-corner br"></div>
        <div class="scan-line"></div>
        <div class="qr-icon">â¬›</div>
      </div>
      <div style="font-size:16px;font-weight:900;">æƒæå‹•æ…‹ QR ç¢¼</div>
      <div class="qr-info">å°‡é¡é ­å°æº–å•†å®¶çš„å‹•æ…‹æ—‹è½‰ QR ç¢¼ã€‚<br>ç¢ºèªå¯¦éš›åˆ°å ´å¾Œï¼Œç·©è¡æœŸå°‡ç«‹å³è§£é™¤ã€‚</div>
      <button class="primary-btn" style="margin-top:20px;" onclick="triggerExemption('qr')">æ¨¡æ“¬ QR é©—è­‰æˆåŠŸ âœ“</button>
      <button class="secondary-btn" onclick="showScreen('exemption')">å–æ¶ˆ</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šå–å›è³‡é‡‘ç¢ºèª
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-withdraw">
    <div class="screen-header">
      <div class="back-btn" onclick="backToBuffer()">â†</div>
      <div class="screen-title">å–å›æš«å­˜è³‡é‡‘</div>
    </div>
    <div class="withdraw-screen">
      <div class="big-icon">ğŸ’°</div>
      <div class="confirm-title">ç«‹å³å–å›è³‡é‡‘</div>
      <div class="confirm-sub">æ‚¨çš„è³‡é‡‘å·²æš«å­˜ï¼Œå®Œå…¨ç”±æ‚¨æŒæ§ã€‚å¯ç«‹å³é›¶æ‰‹çºŒè²»é€€å›æ‚¨çš„å¸³æˆ¶ã€‚</div>
      <div class="amount-confirm">
        <div class="label">æš«å­˜é‡‘é¡</div>
        <div class="value" id="withdrawAmountDisplay">â€”</div>
      </div>
      <button class="danger-btn" onclick="triggerWithdraw()">ç«‹å³å–å› Â· é€€å›æˆ‘çš„å¸³æˆ¶</button>
      <button class="secondary-btn" style="margin:0;" onclick="backToBuffer()">ç¹¼çºŒä¿ç•™åœ¨ç·©è¡æœŸ</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ç•«é¢ï¼šå®Œæˆçµæœ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="screen" id="screen-success">
    <div class="withdraw-screen" style="padding-top:60px;">
      <div class="big-icon success-anim" id="successIcon">âœ…</div>
      <div class="confirm-title" id="successTitle">è³‡é‡‘å·²é€€å›</div>
      <div class="confirm-sub"   id="successSub">å·²é€€å›æ‚¨çš„å¸³æˆ¶ï¼Œæœ¬æ¬¡æœªç™¼ç”Ÿä»»ä½•è½‰å¸³ã€‚</div>

      <div style="margin-top:28px;background:var(--surface2);border:1px solid var(--border);border-radius:20px;padding:20px;text-align:left;">
        <div style="font-size:10px;color:var(--muted);letter-spacing:1px;margin-bottom:12px;">ä¿è­·æ‘˜è¦</div>
        <div style="display:flex;flex-direction:column;gap:10px;">
          <div class="row-between">
            <span style="font-size:12px;color:var(--muted);">è½‰å¸³é‡‘é¡</span>
            <span style="font-size:12px;font-weight:700;color:var(--text);" id="summaryAmount">â€”</span>
          </div>
          <div class="row-between">
            <span style="font-size:12px;color:var(--muted);">æ”¶æ¬¾æ–¹æ˜¯å¦æ”¶åˆ°é€šçŸ¥ï¼Ÿ</span>
            <span style="font-size:12px;font-weight:700;color:var(--accent);">å¾æœªé€šçŸ¥</span>
          </div>
          <div class="row-between">
            <span style="font-size:12px;color:var(--muted);">BSP æœ€çµ‚åˆ†æ•¸</span>
            <span style="font-size:12px;font-weight:700;color:var(--warn);" id="summaryBsp">â€”</span>
          </div>
          <div class="row-between">
            <span style="font-size:12px;color:var(--muted);">æœ€çµ‚çµæœ</span>
            <span style="font-size:12px;font-weight:700;color:var(--accent);" id="outcomeText">è½‰å¸³å·²å–æ¶ˆ</span>
          </div>
        </div>
      </div>

      <button class="primary-btn" style="margin-top:20px;" onclick="resetApp()">å®Œæˆ</button>
    </div>
  </div>

</div><!-- /phone-shell -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å…¨åŸŸç‹€æ…‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let timerInterval     = null;
let totalSeconds      = 0;
let maxSeconds        = 5 * 60;
let currentAmount     = 0;
let bspLevel          = 22;
let hesitationSeconds = 0;
let hesitationTimer   = null;
let bufferActive      = false;  // æ˜¯å¦å·²é€²å…¥ç·©è¡ç‹€æ…‹

/* â”€â”€ çŒ¶è±«è¨ˆæ™‚å¾è¼‰å…¥èµ·ç®— â”€â”€ */
function startHesitationTimer() {
  if (hesitationTimer) return;
  hesitationTimer = setInterval(() => { hesitationSeconds++; }, 1000);
}
function stopHesitationTimer() {
  if (hesitationTimer) { clearInterval(hesitationTimer); hesitationTimer = null; }
}
startHesitationTimer();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   éŠ€è¡Œä»£ç¢¼è¼¸å…¥ï¼ˆå­—å…ƒæ ¼æ¸²æŸ“ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderDigitDisplay(displayId, value, totalSlots) {
  const el = document.getElementById(displayId);
  if (!el) return;
  let html = '';
  for (let i = 0; i < Math.max(value.length, totalSlots); i++) {
    if (i < value.length) {
      html += '<span class="dc">' + value[i] + '</span>';
    } else {
      html += '<span class="dp">0</span>';
    }
  }
  el.innerHTML = html;
}

function onBankCodeInput(el) {
  el.value = el.value.replace(/\D/g, '');
  renderDigitDisplay('bankCodeDisplay', el.value, 3);
  validateBankFields();
}

function onBankAcctInput(el) {
  el.value = el.value.replace(/\D/g, '');
  renderDigitDisplay('bankAcctDisplay', el.value, 16);
  validateBankFields();
}

function validateBankFields() {
  const code = document.getElementById('bankCodeInput').value.trim();
  const acct = document.getElementById('bankAcctInput').value.trim();
  const btn  = document.getElementById('nextToAmountBtn');
  const codeOk = /^\d{3,7}$/.test(code);
  const acctOk = /^\d{10,16}$/.test(acct);
  btn.disabled = !(codeOk && acctOk);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å‰å¾€é‡‘é¡é 
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goToAmount() {
  const code = document.getElementById('bankCodeInput').value.trim();
  const acct = document.getElementById('bankAcctInput').value.trim();
  // åœ¨æ”¶æ¬¾äººæ‘˜è¦é¡¯ç¤ºå¸³è™Ÿè³‡è¨Š
  const display = 'éŠ€è¡Œ ' + code + 'ã€€å¸³è™Ÿæœ«4ç¢¼ ****' + acct.slice(-4);
  document.getElementById('recipientAcctDisplay').textContent = display;
  showScreen('amount');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   é‡‘é¡è¼¸å…¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onAmountInput(el) {
  let raw = el.value.replace(/[^\d.]/g, '');
  const parts = raw.split('.');
  if (parts.length > 2) raw = parts[0] + '.' + parts.slice(1).join('');
  if (parts[1] && parts[1].length > 2) raw = parts[0] + '.' + parts[1].slice(0, 2);
  const numVal = parseFloat(raw.replace(/,/g, ''));
  currentAmount = isNaN(numVal) ? 0 : numVal;
  el.value = raw.includes('.')
    ? (raw.split('.')[0] === '' ? '' : addCommas(raw.split('.')[0])) + '.' + raw.split('.')[1]
    : (raw === '' ? '' : addCommas(raw));
  validateAmount();
  updateCoolingPreview();
}
function onAmountBlur(el) {
  if (currentAmount > 0) el.value = currentAmount.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 2 });
  validateAmount();
  updateCoolingPreview();
}
function addCommas(s) { return s.replace(/,/g,'').replace(/\B(?=(\d{3})+(?!\d))/g,','); }
function fmtAmt(n)    { return '$' + n.toLocaleString('zh-TW', { minimumFractionDigits: 0, maximumFractionDigits: 2 }); }

function validateAmount() {
  const errEl = document.getElementById('amountError');
  const btn   = document.getElementById('confirmTransferBtn');
  if (currentAmount <= 0)        { errEl.textContent = ''; btn.disabled = true; }
  else if (currentAmount < 1)    { errEl.textContent = 'âš  é‡‘é¡ä¸å¾—ä½æ–¼ $1'; btn.disabled = true; }
  else if (currentAmount > 500000){ errEl.textContent = 'âš  å–®ç­†ä¸Šé™ç‚º $500,000ï¼Œè«‹æ‹†åˆ†è½‰å¸³'; btn.disabled = true; }
  else                           { errEl.textContent = ''; btn.disabled = false; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å†·éœç·©è¡æœŸè¨ˆç®—
   è¦å‰‡ Aï¼ˆçŒ¶è±«æ™‚é–“ï¼‰  è¦å‰‡ Bï¼ˆé‡‘é¡ï¼‰  å–è¼ƒå¤§å€¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calcCoolingMinutes(hesitSec, amount) {
  const mH = hesitSec < 20 ? 5 : hesitSec <= 60 ? 10 : 15;
  const mA = amount <= 20000 ? 5 : amount <= 50000 ? 10 : 15;
  return Math.max(mH, mA);
}
function getCoolingReason(hesitSec, amount) {
  const mH = hesitSec < 20 ? 5 : hesitSec <= 60 ? 10 : 15;
  const mA = amount <= 20000 ? 5 : amount <= 50000 ? 10 : 15;
  if (mH >= mA) {
    const lbl = hesitSec < 20 ? '< 20 ç§’' : hesitSec <= 60 ? '20â€“60 ç§’' : '> 60 ç§’';
    return 'ä¾çŒ¶è±«æ™‚é–“ï¼ˆ' + lbl + 'ï¼‰â†’ ' + mH + ' åˆ†é˜';
  } else {
    const lbl = amount <= 20000 ? 'â‰¤ $20,000' : amount <= 50000 ? '$20,001â€“$50,000' : 'â‰¥ $50,001';
    return 'ä¾è½‰å¸³é‡‘é¡ï¼ˆ' + lbl + 'ï¼‰â†’ ' + mA + ' åˆ†é˜';
  }
}

function updateCoolingPreview() {
  const el = document.getElementById('coolingPreview');
  if (!el || currentAmount <= 0) { if(el) el.textContent=''; return; }
  const mins = calcCoolingMinutes(hesitationSeconds, currentAmount);
  el.textContent = 'é è¨ˆç·©è¡æ™‚é–“ï¼š' + mins + ' åˆ†é˜';
  el.style.color = mins === 5 ? 'var(--accent)' : mins === 10 ? 'var(--warn)' : 'var(--accent2)';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   é€²å…¥ç·©è¡ç‹€æ…‹ï¼ˆè¦†è“‹é‡‘é¡é ã€ä¸æ›é ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goToBuffer() {
  if (currentAmount <= 0) return;
  stopHesitationTimer();

  const mins   = calcCoolingMinutes(hesitationSeconds, currentAmount);
  const reason = getCoolingReason(hesitationSeconds, currentAmount);
  maxSeconds   = mins * 60;
  totalSeconds = maxSeconds;

  const fmt = fmtAmt(currentAmount);
  document.getElementById('bufferAmountDisplay').textContent   = fmt;
  document.getElementById('withdrawAmountDisplay').textContent = fmt;
  document.getElementById('coolingReason').textContent         = reason;
  document.getElementById('bufferDurationPill').textContent    = mins + ' åˆ†é˜';

  // éš±è—è½‰å¸³è¡¨å–®ï¼Œé¡¯ç¤ºç·©è¡è¦†è“‹å±¤ï¼ˆä»åœ¨åŒä¸€ç•«é¢ï¼‰
  document.getElementById('transferContent').style.display = 'none';
  document.getElementById('bufferOverlay').classList.add('active');
  bufferActive = true;

  updateTimerDisplay();
  startCountdown();
  // æ›´æ–°é ‚éƒ¨å°è¦½ï¼ˆè½‰å¸³æ¨™ç±¤ä¿æŒ activeï¼‰
  document.querySelectorAll('.nav-tab')[0].classList.add('active');
}

function backToBuffer() {
  showScreen('amount');
  // ç¢ºä¿è¦†è“‹å±¤ç‹€æ…‹æ­£ç¢º
  if (bufferActive) {
    document.getElementById('transferContent').style.display = 'none';
    document.getElementById('bufferOverlay').classList.add('active');
  }
}

function showWithdraw() {
  stopCountdown();
  showScreen('withdraw');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç•«é¢åˆ‡æ›
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
  const sc = document.getElementById('screen-' + id);
  if (sc) sc.classList.add('active');
  // æ¨™ç±¤å°æ‡‰
  const tabMap = { bank: 0, amount: 0, exemption: 1, 'utility-category': 1, 'utility-acct': 1, qr: 1 };
  const tabs = document.querySelectorAll('.nav-tab');
  if (tabMap[id] !== undefined) tabs[tabMap[id]]?.classList.add('active');
  // å€’æ•¸åªåœ¨ amount ä¸”ç·©è¡ä¸­æ‰ç¹¼çºŒ
  if (id !== 'amount' || !bufferActive) stopCountdown();
  if (id === 'amount' && bufferActive) startCountdown();
  // å›åˆ°éŠ€è¡Œé é‡å•ŸçŒ¶è±«è¨ˆæ™‚
  if (id === 'bank') startHesitationTimer();
}

/* navToï¼šé ‚éƒ¨ tab é»æ“Š */
function navTo(id) {
  // è‹¥ç·©è¡ä¸­ï¼Œtab é»è½‰å¸³ç›´æ¥è·³å› amountï¼ˆç·©è¡ç‹€æ…‹ï¼‰
  if (id === 'bank' && bufferActive) { showScreen('amount'); return; }
  showScreen(id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å€’æ•¸è¨ˆæ™‚å™¨
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function startCountdown() {
  if (timerInterval) return;
  timerInterval = setInterval(() => {
    if (totalSeconds > 0) { totalSeconds--; updateTimerDisplay(); }
    else { clearInterval(timerInterval); timerInterval = null; }
  }, 1000);
}
function stopCountdown() {
  if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
}
function updateTimerDisplay() {
  const m = Math.floor(totalSeconds / 60);
  const s = totalSeconds % 60;
  const el = document.getElementById('timerDisplay');
  if (el) el.textContent = String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');
  const progress = maxSeconds > 0 ? totalSeconds / maxSeconds : 1;
  const ring = document.getElementById('ringProgress');
  if (ring) {
    ring.style.strokeDashoffset = 345 * (1 - progress);
    ring.style.stroke = progress > 0.5 ? 'var(--accent)' : progress > 0.25 ? 'var(--warn)' : '#ff4444';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ç™½åå–®é¢æ¿
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleWhitelistPanel() {
  const panel = document.getElementById('whitelistPanel');
  const arrow = document.getElementById('wlArrow');
  const open  = panel.classList.toggle('open');
  arrow.textContent = open ? 'âˆ¨' : 'â€º';
  document.getElementById('wlError').textContent = '';
}
function submitWhitelist() {
  const code = document.getElementById('wlBankCode').value.trim();
  const acct = document.getElementById('wlBankAcct').value.trim();
  const err  = document.getElementById('wlError');
  if (!/^\d{3,7}$/.test(code))   { err.textContent = 'âš  éŠ€è¡Œä»£ç¢¼é ˆç‚º 3ï½7 ä½æ•¸å­—'; return; }
  if (!/^\d{10,16}$/.test(acct)) { err.textContent = 'âš  å¸³è™Ÿé ˆç‚º 10ï½16 ä½æ•¸å­—'; return; }
  err.textContent = '';
  triggerExemption('whitelist');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å·²é©—è­‰æ©Ÿæ§‹ï¼šé¡åˆ¥é¸æ“‡
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let selectedUtilityCategory = null;

function selectUtilityCategory(key, icon, name, desc) {
  selectedUtilityCategory = { key, icon, name, desc };
  // æ›´æ–°å¸³è™Ÿé çš„å¾½ç« 
  document.getElementById('utilitySelIcon').textContent = icon;
  document.getElementById('utilitySelName').textContent = name;
  // é‡ç½®å¸³è™Ÿè¼¸å…¥
  const inp = document.getElementById('utilityAcctInput');
  inp.value = '';
  renderDigitDisplay('utilityAcctDisplay', '', 16);
  document.getElementById('utilityAcctError').textContent = '';
  document.getElementById('utilityConfirmBtn').disabled = true;
  document.getElementById('utilityConfirmCard').style.display = 'none';
  showScreen('utility-acct');
}

function onUtilityAcctInput(el) {
  el.value = el.value.replace(/\D/g, '');
  renderDigitDisplay('utilityAcctDisplay', el.value, 16);
  const btn = document.getElementById('utilityConfirmBtn');
  const card = document.getElementById('utilityConfirmCard');
  const err  = document.getElementById('utilityAcctError');
  if (/^\d{10,16}$/.test(el.value)) {
    btn.disabled = false;
    err.textContent = '';
    // æ›´æ–°ç¢ºèªæ‘˜è¦
    card.style.display = 'flex';
    document.getElementById('utilityConfirmIcon').textContent = selectedUtilityCategory?.icon || 'ğŸ¢';
    document.getElementById('utilityConfirmName').textContent = selectedUtilityCategory?.name || 'å·²é©—è­‰æ©Ÿæ§‹';
    document.getElementById('utilityConfirmAcct').textContent = 'å¸³è™Ÿæœ« 4 ç¢¼ï¼š****' + el.value.slice(-4);
  } else {
    btn.disabled = true;
    card.style.display = 'none';
    if (el.value.length > 0 && el.value.length < 10) {
      err.textContent = 'âš  å¸³è™Ÿé ˆç‚º 10ï½16 ä½æ•¸å­—';
    } else {
      err.textContent = '';
    }
  }
}

function submitUtilityTransfer() {
  const acct = document.getElementById('utilityAcctInput').value.trim();
  if (!/^\d{10,16}$/.test(acct)) {
    document.getElementById('utilityAcctError').textContent = 'âš  å¸³è™Ÿé ˆç‚º 10ï½16 ä½æ•¸å­—';
    return;
  }
  triggerExemption('utility');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   è±å…è·¯å¾‘è§¸ç™¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function triggerExemption(type) {
  stopCountdown(); stopHesitationTimer();
  const amtStr = currentAmount > 0 ? fmtAmt(currentAmount) : 'æŒ‡å®šé‡‘é¡';
  const msgs = {
    whitelist: { icon:'ğŸ‘¥', title:'ä¿¡ä»»è¯çµ¡äººé©—è­‰æˆåŠŸ', sub:'åœ°ç†ä½ç½®å·²ç¢ºèªï¼Œ'+amtStr+' å·²ç«‹å³ç™¼é€ï¼Œç·©è¡æœŸå·²ç¹éã€‚', outcome:'è±å…ï¼ˆç™½åå–®ï¼‰' },
    utility:   { icon: selectedUtilityCategory?.icon || 'ğŸ¢', title:'æ©Ÿæ§‹é©—è­‰æˆåŠŸ',         sub:amtStr+' å·²ç›´æ¥è½‰å¸³è‡³ã€Œ'+(selectedUtilityCategory?.name||'å·²é©—è­‰æ©Ÿæ§‹')+'ã€ï¼Œç„¡éœ€ç·©è¡æœŸã€‚', outcome:'è±å…ï¼ˆé©—è­‰æ©Ÿæ§‹ï¼‰' },
    qr:        { icon:'ğŸ“±', title:'QR é©—è­‰æˆåŠŸ Â· ç¾å ´ç¢ºèª', sub:'å‹•æ…‹ QR ç¢¼ç¢ºèªå¯¦éš›åˆ°å ´ï¼Œ'+amtStr+' å·²ç«‹å³è½‰å¸³è‡³å•†å®¶ã€‚', outcome:'è±å…ï¼ˆQR æƒæï¼‰' }
  };
  const msg = msgs[type] || msgs.whitelist;
  const icon = document.getElementById('successIcon');
  icon.textContent = msg.icon;
  icon.classList.remove('success-anim'); void icon.offsetWidth; icon.classList.add('success-anim');
  document.getElementById('successTitle').textContent  = msg.title;
  document.getElementById('successSub').textContent    = msg.sub;
  document.getElementById('outcomeText').textContent   = msg.outcome;
  document.getElementById('summaryAmount').textContent = amtStr;
  document.getElementById('summaryBsp').textContent    = getBspLabel();
  showScreen('success');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å–å›è³‡é‡‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function triggerWithdraw() {
  stopCountdown(); stopHesitationTimer();
  const amtStr = currentAmount > 0 ? fmtAmt(currentAmount) : 'å·²æš«å­˜é‡‘é¡';
  const icon = document.getElementById('successIcon');
  icon.textContent = 'ğŸ’¸';
  icon.classList.remove('success-anim'); void icon.offsetWidth; icon.classList.add('success-anim');
  document.getElementById('successTitle').textContent  = 'è³‡é‡‘å·²é€€å›';
  document.getElementById('successSub').textContent    = amtStr + ' å·²ç«‹å³é€€å›æ‚¨çš„å¸³æˆ¶ã€‚æ”¶æ¬¾æ–¹å¾æœªæ”¶åˆ°ä»»ä½•é€šçŸ¥ã€‚';
  document.getElementById('outcomeText').textContent   = 'è½‰å¸³å·²å–æ¶ˆ';
  document.getElementById('summaryAmount').textContent = amtStr;
  document.getElementById('summaryBsp').textContent    = getBspLabel();
  showScreen('success');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   å¾è½‰å¸³é é€²å…¥è±å…è·¯å¾‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function goToExemptionFromTransfer() {
  document.getElementById('exemptionBackBtn').onclick = () => showScreen('amount');
  if (currentAmount > 0) {
    document.getElementById('bufferAmountDisplay').textContent   = fmtAmt(currentAmount);
    document.getElementById('withdrawAmountDisplay').textContent = fmtAmt(currentAmount);
  }
  showScreen('exemption');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   é‡ç½®
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetApp() {
  stopCountdown(); stopHesitationTimer();
  totalSeconds = 0; maxSeconds = 5*60; bspLevel = 22;
  currentAmount = 0; hesitationSeconds = 0; bufferActive = false;

  updateTimerDisplay(); updateBspDisplay();

  // é‡ç½®éŠ€è¡Œé 
  const bci = document.getElementById('bankCodeInput');
  const bai = document.getElementById('bankAcctInput');
  if (bci) { bci.value = ''; renderDigitDisplay('bankCodeDisplay', '', 3); }
  if (bai) { bai.value = ''; renderDigitDisplay('bankAcctDisplay', '', 16); }
  document.getElementById('bankCodeError') && (document.getElementById('bankCodeError').textContent = '');
  document.getElementById('bankAcctError') && (document.getElementById('bankAcctError').textContent = '');
  document.getElementById('nextToAmountBtn').disabled = true;

  // é‡ç½®é‡‘é¡é 
  document.getElementById('amountInput').value    = '';
  document.getElementById('amountError').textContent    = '';
  document.getElementById('coolingPreview').textContent = '';
  document.getElementById('confirmTransferBtn').disabled = true;

  // é‡ç½®è¦†è“‹å±¤
  document.getElementById('transferContent').style.display = '';
  document.getElementById('bufferOverlay').classList.remove('active');

  // é‡ç½®è±å…
  document.getElementById('wlBankCode').value = '';
  document.getElementById('wlBankAcct').value = '';
  document.getElementById('wlError').textContent  = '';
  document.getElementById('whitelistPanel').classList.remove('open');
  document.getElementById('wlArrow').textContent  = 'â€º';
  // é‡ç½®å·²é©—è­‰æ©Ÿæ§‹
  selectedUtilityCategory = null;
  const uai = document.getElementById('utilityAcctInput');
  if (uai) { uai.value = ''; renderDigitDisplay('utilityAcctDisplay', '', 16); }
  const uErr = document.getElementById('utilityAcctError');
  if (uErr) uErr.textContent = '';
  const uCard = document.getElementById('utilityConfirmCard');
  if (uCard) uCard.style.display = 'none';
  const uBtn = document.getElementById('utilityConfirmBtn');
  if (uBtn) uBtn.disabled = true;

  showScreen('bank');
  document.querySelectorAll('.nav-tab')[0].classList.add('active');
  startHesitationTimer();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BSP åˆ†æ•¸
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getBspLabel()      { const v=Math.round(bspLevel); return bspLevel<30?'æ­£å¸¸ Â· '+v+'%':bspLevel<46?'è¼•åº¦ç•°å¸¸ Â· '+v+'%':bspLevel<61?'ä¸­åº¦ç•°å¸¸ Â· '+v+'%':'åé«˜ Â· '+v+'%'; }
function getBspColor()      { return bspLevel<30?'var(--accent)':bspLevel<46?'#c8a020':bspLevel<61?'var(--warn)':'var(--accent2)'; }
function getBspBarGrad()    { return bspLevel<30?'linear-gradient(90deg,var(--accent),var(--staged))':bspLevel<46?'linear-gradient(90deg,var(--accent),#c8a020)':'linear-gradient(90deg,var(--accent),var(--warn))'; }
function getBspPillText()   { return bspLevel<30?'æ­£å¸¸':bspLevel<46?'è¼•åº¦ç•°å¸¸':bspLevel<61?'ä¸­åº¦ç•°å¸¸':'åé«˜'; }

function updateBspDisplay() {
  const bar=document.getElementById('bspBar'), lvl=document.getElementById('bspLevelText'), pill=document.getElementById('bspStatusPill');
  if (!bar) return;
  const c = getBspColor();
  bar.style.width = bspLevel.toFixed(1)+'%';
  bar.style.background = getBspBarGrad();
  if (lvl)  { lvl.textContent = getBspLabel();    lvl.style.color = c; }
  if (pill) { pill.textContent = getBspPillText(); pill.style.color = c; }
  ['bspTag1','bspTag2'].forEach(id => {
    const t=document.getElementById(id); if(!t) return;
    bspLevel>=46 ? t.classList.add('elevated') : t.classList.remove('elevated');
  });
}
updateBspDisplay();

const BSP_BASELINE=25, BSP_MAX=58;
setInterval(() => {
  let d = (Math.random()*2.0)-1.0;
  d -= (bspLevel-BSP_BASELINE)*0.10;
  if (Math.random()<0.04) {
    d += 10+Math.random()*8;
    const t2=document.getElementById('bspTag2');
    if(t2){ t2.textContent='ğŸ”„ åˆ‡æ›æ‡‰ç”¨ç¨‹å¼'; t2.classList.add('elevated'); setTimeout(()=>{ if(t2) t2.textContent='â¸ è¼•å¾®çŒ¶è±«'; },5000); }
  }
  bspLevel = Math.max(15, Math.min(BSP_MAX, bspLevel+d));
  updateBspDisplay();
}, 3000);
</script>
</body>
</html>
